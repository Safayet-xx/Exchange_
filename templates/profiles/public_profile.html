{% extends "base.html" %}
{% block title %}{{ profile.display_name|default:profile.user.email }} - Profile{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Left Sidebar - Profile Card -->
        <div class="col-md-4">
            <!-- Profile Card -->
            <div class="card mb-4 shadow">
                <div class="card-body text-center">
                    <div class="mb-3">
                        <div style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; margin: 0 auto; color: white; font-size: 3rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                            {{ profile.display_name.0|upper|default:'?' }}
                        </div>
                    </div>
                    <h3 class="fw-bold">{{ profile.display_name|default:profile.full_name|default:profile.user.email }}</h3>
                    <p class="text-muted mb-2">@{{ profile.handle }}</p>
                    <span class="badge {% if profile.role == 'professor' %}bg-primary{% else %}bg-success{% endif %} mb-3 px-3 py-2">
                        {{ profile.get_role_display }}
                    </span>
                    
                    {% if profile.average_rating %}
                        <div class="mb-3">
                            <strong style="font-size: 1.1rem;">‚≠ê {{ profile.average_rating }}/5</strong>
                            <br>
                            <small class="text-muted">({{ profile.rating_count }} reviews)</small>
                        </div>
                    {% endif %}
                    
                    <!-- Edit Profile Button (only for own profile) -->
                    {% if user.is_authenticated and user == profile.user %}
                        <a href="{% url 'profiles:setup' %}" class="btn btn-primary btn-sm w-100 mb-2">
                            <i class="bi bi-pencil-square"></i> Edit Profile
                        </a>
                    {% endif %}
                </div>
            </div>

            <!-- Contact Information -->
            <div class="card mb-4 shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-telephone-fill"></i> Contact Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong style="color: #495057; font-size: 0.95rem;">Email:</strong>
                        <div style="color: #212529; font-size: 0.9rem;">
                            <a href="mailto:{{ profile.user.email }}" style="color: #667eea;">{{ profile.user.email }}</a>
                        </div>
                    </div>
                    <div class="mb-3">
                        <strong style="color: #495057; font-size: 0.95rem;">University:</strong>
                        <div style="color: #212529; font-size: 0.9rem;">
                            {{ profile.university|default:'Not specified' }}
                        </div>
                    </div>
                    <div class="mb-0">
                        <strong style="color: #495057; font-size: 0.95rem;">Joined:</strong>
                        <div style="color: #212529; font-size: 0.9rem;">
                            {{ profile.joined_date|date:"F Y"|default:"Recently" }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="card shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-bar-chart-fill"></i> Stats</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <strong style="color: #495057; font-size: 0.95rem;">Skills:</strong>
                        <div style="color: #212529; font-size: 1.1rem; font-weight: 600;">
                            {{ profile.user.user_skills.count }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <strong style="color: #495057; font-size: 0.95rem;">Sessions Helped:</strong>
                        <div style="color: #212529; font-size: 1.1rem; font-weight: 600;">
                            {{ profile.total_sessions_helped|default:0 }}
                        </div>
                    </div>
                    <div class="mb-0">
                        <strong style="color: #495057; font-size: 0.95rem;">Credits Earned:</strong>
                        <div style="color: #212529; font-size: 1.1rem; font-weight: 600;">
                            {{ profile.total_credits_earned|default:0 }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-8">
            <!-- About Section -->
            <div class="card mb-4 shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-person-fill"></i> About Me</h5>
                </div>
                <div class="card-body" style="background-color: #fff;">
                    <p style="color: #212529; font-size: 1rem; line-height: 1.6;">
                        {{ profile.bio|default:'No bio provided yet.' }}
                    </p>
                </div>
            </div>

            <!-- Personal Info -->
            <div class="card mb-4 shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-info-circle-fill"></i> Personal Information</h5>
                </div>
                <div class="card-body" style="background-color: #fff;">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong style="color: #495057; font-size: 0.95rem;">Full Name:</strong>
                            <div style="color: #212529; font-size: 1rem; font-weight: 500;">
                                {{ profile.full_name|default:'Not specified' }}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong style="color: #495057; font-size: 0.95rem;">Hobbies:</strong>
                            <div style="color: #212529; font-size: 1rem; font-weight: 500;">
                                {{ profile.hobbies|default:'Not specified' }}
                            </div>
                        </div>
                        <div class="col-md-12">
                            <strong style="color: #495057; font-size: 0.95rem;">Fun Fact:</strong>
                            <div style="color: #212529; font-size: 1rem; font-weight: 500;">
                                {{ profile.fun_fact|default:'Not specified' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Skills Section -->
            <div class="card mb-4 shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-award-fill"></i> Skills & Expertise</h5>
                </div>
                <div class="card-body" style="background-color: #fff;">
                    {% if profile.user.user_skills.all %}
                        <div class="row">
                            {% for user_skill in profile.user.user_skills.all %}
                                <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3" style="background-color: #f8f9fa; border-color: #dee2e6 !important;">
                                        <h6 style="color: #212529; font-weight: 600;">{{ user_skill.skill.name }}</h6>
                                        <p class="mb-1">
                                            <span class="badge bg-primary">{{ user_skill.get_proficiency_level_display }}</span>
                                            <span class="badge bg-info text-dark">{{ user_skill.years_of_experience }} years</span>
                                        </p>
                                        {% if user_skill.description %}
                                            <p class="mb-0 small" style="color: #495057;">{{ user_skill.description|truncatewords:15 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-center text-muted mb-0" style="padding: 2rem;">
                            <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                            <br>
                            No skills added yet.
                        </p>
                    {% endif %}
                </div>
            </div>

            <!-- Recent Activity / Posts -->
            <div class="card shadow">
                <div class="card-header" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                    <h5 class="mb-0"><i class="bi bi-grid-3x3-gap-fill"></i> Recent Posts</h5>
                </div>
                <div class="card-body" style="background-color: #fff;">
                    {% if profile.user.posts.all %}
                        <div class="list-group list-group-flush">
                            {% for post in profile.user.posts.all|slice:":5" %}
                                <div class="list-group-item border-0 mb-2" style="background-color: #f8f9fa; border-radius: 8px;">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="mb-1" style="color: #212529; font-weight: 600;">{{ post.title }}</h6>
                                            <p class="mb-1 small" style="color: #495057;">{{ post.description|truncatewords:20 }}</p>
                                            <small class="text-muted">{{ post.created_at|timesince }} ago</small>
                                        </div>
                                        <span class="badge {% if post.post_type == 'offer' %}bg-success{% else %}bg-primary{% endif %}">
                                            {{ post.get_post_type_display }}
                                        </span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-center text-muted mb-0" style="padding: 2rem;">
                            <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                            <br>
                            No posts yet.
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_css %}
<style>
    /* Enhanced visibility styles */
    .card {
        border: none !important;
    }
    
    .card-header h5 {
        font-weight: 600 !important;
    }
    
    .card-body strong {
        display: block;
        margin-bottom: 0.25rem;
    }
    
    /* Better contrast for text */
    .card-body {
        color: #212529 !important;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        .card-header h5 {
            font-size: 1rem !important;
        }
        
        .card-body {
            padding: 1rem !important;
        }
    }
</style>
{% endblock %}
{% endblock %}
